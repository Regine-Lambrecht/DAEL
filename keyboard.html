<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard experience - Checkout Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .transition-all { transition: all 0.3s ease; }

        /* Hide the default dropdown arrow for datalists/fields */
        input::-webkit-calendar-picker-indicator {
            display: none !important;
            -webkit-appearance: none;
            opacity: 0;
        }

        /* "The Bad Way" CSS - Deliberately breaking focus visualization */
        .inaccessible-mode *:focus {
            outline: none !important;
            box-shadow: none !important;
        }

        /* --- PERSISTENT KEYBOARD ACCESSIBILITY FOR LAB CONTROLS --- */
        .lang-btn:focus-visible, 
        #critiqueToggle:focus-visible {
            outline: 2px solid #2563eb !important;
            outline-offset: 2px !important;
            border-radius: 4px;
        }

        .switch input:focus-visible + .slider {
            outline: 2px solid #2563eb;
            outline-offset: 4px;
            box-shadow: 0 0 0 2px white;
        }

        /* Always show focus on Month/Year in Calendar */
        #monthSelect:focus, #yearSelect:focus {
            outline: 2px solid #2563eb !important;
            outline-offset: 1px;
        }

        /* Checkbox focus is hidden in inaccessible mode */
        .inaccessible-mode #checkTerms:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        
        .accessible-mode #checkTerms:focus-visible {
            outline: 2px solid #2563eb !important;
            outline-offset: 2px;
        }

        /* INACCESSIBLE DIALOG: Subtle light blue border flush with button edge */
        .inaccessible-mode .modal-content button:focus {
            outline: 1px solid #93c5fd !important; 
            outline-offset: 0px !important;
            box-shadow: none !important;
        }

        /* "The Good Way" CSS - WCAG 2.2 Focus Appearance */
        .accessible-mode *:focus-visible {
            outline: 3px solid #2563eb !important;
            outline-offset: 2px !important;
            box-shadow: inset 0 0 0 2px white !important;
            border-radius: 4px;
        }

        /* ACCESSIBLE DIALOG: Blue ring + EXACT 1px INNER WHITE BORDER focus */
        .accessible-mode .modal-content button:focus-visible {
            box-shadow: inset 0 0 0 1px white !important; 
            outline: 3px solid #2563eb !important; 
            outline-offset: 0px !important;
        }

        /* Tooltip Styles */
        .tooltip-box {
            display: none;
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            width: 180px;
            z-index: 50;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .tooltip-box::after {
            content: "";
            position: absolute;
            top: 50%;
            right: 100%;
            top: 50%;
            margin-top: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent #1f2937 transparent transparent;
        }

        /* Tooltip Visibility: Show on mouseover for both versions */
        .info-icon-bad:hover ~ .tooltip-box, 
        .info-icon-good:hover ~ .tooltip-box { 
            display: block; 
        }
        
        /* Persistent visible class for click trigger (Accessible version) */
        .tooltip-visible { display: block !important; }
        .hidden-forced { display: none !important; }

        /* Calendar Styling */
        .calendar-popup {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 0.5rem;
            background: white;
            border: 1px solid #6b7280;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            z-index: 40;
            padding: 10px;
            border-radius: 10px;
            width: 240px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: #f3f4f6;
            padding: 6px;
            border-radius: 6px;
        }
        
        .calendar-day {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* Inaccessible Focus: Blue background + white text */
        .inaccessible-mode .calendar-day:focus {
            background-color: #2563eb !important;
            color: white !important;
            outline: none !important;
        }

        /* Accessible Focus: Blue Circle */
        .accessible-mode .calendar-day:focus-visible {
            outline: none !important;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #2563eb !important;
            border-radius: 9999px !important;
            z-index: 10;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        /* Toggle switch styling */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ef4444; transition: .4s; border-radius: 28px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #15803d; }
        input:checked + .slider:before { transform: translateX(22px); }

        .demo-container { max-width: 1000px; margin: 0 auto; }
        
        .btn-disabled {
            opacity: 0.4;
            cursor: not-allowed !important;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 font-sans transition-colors duration-500 inaccessible-mode" id="bodyTag">

    <div class="demo-container bg-white shadow-2xl rounded-3xl overflow-hidden">
        
        <header class="p-4 md:p-6 border-b border-gray-100 flex flex-col gap-4 bg-white sticky top-0 z-50">
            <!-- Tools bar -->
            <div class="flex flex-wrap items-center justify-between gap-4 bg-gray-50 p-3 rounded-2xl border border-gray-200 w-full">
                <div class="flex items-center gap-4">
                    <!-- Mode Switcher -->
                    <div class="flex items-center gap-2 pr-4 border-r border-gray-200">
                        <span id="statusLabel" class="text-xs font-black uppercase tracking-widest text-red-600">Inaccessible</span>
                        <label class="switch">
                            <input 
                                type="checkbox" 
                                id="modeToggle" 
                                onchange="toggleMode()" 
                                role="switch" 
                                aria-label="Toggle accessibility version"
                                aria-checked="false"
                            >
                            <span class="slider"></span>
                        </label>
                        <span id="accessibleLabel" class="text-xs font-black uppercase tracking-widest text-green-700">Accessible</span>
                    </div>

                    <!-- Issues Toggle -->
                    <div class="flex items-center gap-2">
                        <label for="critiqueToggle" id="txt-toggle-critique" class="text-[10px] font-bold text-gray-500 uppercase tracking-widest cursor-pointer">Show issues</label>
                        <input type="checkbox" id="critiqueToggle" onchange="toggleCritiquePanel()" class="w-4 h-4 cursor-pointer">
                    </div>
                </div>

                <!-- Language Switcher -->
                <div class="flex gap-2 text-[10px] font-bold">
                    <button onclick="setLanguage('en')" class="lang-btn px-2 py-1 rounded bg-blue-600 text-white" id="btn-en">EN</button>
                    <button onclick="setLanguage('fr')" class="lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700" id="btn-fr">FR</button>
                    <button onclick="setLanguage('nl')" class="lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700" id="btn-nl">NL</button>
                    <button onclick="setLanguage('de')" class="lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700" id="btn-de">DE</button>
                </div>
            </div>

            <!-- Page Title -->
            <div class="w-full">
                <h1 id="txt-title" class="text-xl font-black text-gray-900 tracking-tight text-left">Keyboard experience</h1>
            </div>
        </header>

        <main id="mainContent" class="p-6 md:p-10">
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-16">
                
                <div class="lg:col-span-1 space-y-6">
                    <div class="space-y-6">
                        
                        <!-- Name Field -->
                        <div class="flex flex-col w-48">
                            <div class="flex items-center gap-2 mb-1">
                                <label for="inputEmail" id="txt-label-email" class="text-xs font-semibold text-gray-600 uppercase tracking-wider">Name Surname</label>
                                <div class="relative flex items-center">
                                    <span id="emailIconBad" class="info-icon-bad w-6 h-6 flex items-center justify-center cursor-help" tabindex="0">
                                        <span class="w-4 h-4 rounded-full bg-blue-700 text-[9px] flex items-center justify-center font-bold text-white">i</span>
                                    </span>
                                    
                                    <button type="button" id="emailIconGood" onclick="toggleTooltip()" onblur="hideTooltip()" class="info-icon-good hidden w-6 h-6 flex items-center justify-center cursor-help hover:opacity-80" aria-label="Name information">
                                        <span class="w-4 h-4 rounded-full bg-blue-700 text-[9px] flex items-center justify-center font-bold text-white">i</span>
                                    </button>
                                    
                                    <div id="txt-tooltip" class="tooltip-box">Here is a help text</div>
                                </div>
                            </div>
                            <input 
                                type="text" 
                                id="inputEmail" 
                                class="border border-gray-500 p-2 rounded-lg bg-gray-50 text-sm w-full" 
                                placeholder=""
                                autocomplete="off"
                                oninput="forceAutocomplete(this)"
                            >
                            <datalist id="email-list">
                                <option id="email-suggestion" value="John Doe">
                            </datalist>
                        </div>

                        <!-- Hidden field "The Void" -->
                        <div class="relative">
                            <input type="text" id="theVoid" class="absolute opacity-0 pointer-events-none" style="width:1px; height:1px;">
                        </div>

                        <!-- Birth Date -->
                        <div class="flex flex-col relative w-48">
                            <label for="inputBirth" id="txt-label-birth" class="text-xs font-semibold text-gray-600 uppercase tracking-wider">Birth Date</label>
                            <span class="text-[9px] text-gray-600 mb-1" id="txt-format-hint">Format: dd/mm/yyyy</span>
                            <div class="relative flex items-center" id="birthFieldWrapper">
                                <input 
                                    type="text" 
                                    id="inputBirth" 
                                    class="w-full border border-gray-500 p-2 pr-10 rounded-lg bg-gray-50 text-sm" 
                                    value=""
                                    onfocus="handleBirthFocus(true)"
                                    readonly
                                >
                                <div class="absolute right-0 top-0 bottom-0 flex items-center pr-2">
                                    <span id="calendarIconBad" class="w-6 h-6 flex items-center justify-center text-sm cursor-default">ðŸ“…</span>
                                    <button 
                                        type="button" 
                                        id="calendarToggleBtn" 
                                        class="hidden w-6 h-6 flex items-center justify-center hover:opacity-70 transition-opacity text-sm focus:outline-none"
                                        aria-label="Open calendar"
                                        onclick="toggleCalendarManual()"
                                    >
                                        ðŸ“…
                                    </button>
                                </div>
                            </div>
                            
                            <div id="calendarContainer" class="calendar-popup">
                                <div class="flex gap-2 mb-2">
                                    <select id="monthSelect" class="text-[10px] border border-gray-500 p-1 rounded bg-white w-1/2"></select>
                                    <select id="yearSelect" class="text-[10px] border border-gray-500 p-1 rounded bg-white w-1/2"></select>
                                </div>
                                <div class="calendar-grid" id="calendarGrid"></div>
                            </div>
                        </div>

                        <!-- Terms Checkbox -->
                        <div class="flex items-center gap-3 py-2 max-w-sm">
                            <input type="checkbox" id="checkTerms" class="w-4 h-4 cursor-pointer" onchange="handleTermsToggle()">
                            <label for="checkTerms" class="text-sm font-semibold text-gray-700">
                                <span id="txt-terms-prefix">I accept the</span> 
                                <a href="https://elevenways.be" target="_blank" class="text-blue-700 underline hover:text-blue-900" id="txt-terms-link">conditions</a>
                            </label>
                        </div>
                    </div>

                    <div class="pt-4 w-48">
                        <div id="submitBad">
                            <div id="txt-btn-bad" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg text-center cursor-pointer shadow transition-colors text-sm btn-disabled" onclick="showMessage('Purchase Complete!')">
                                Complete Purchase
                            </div>
                        </div>
                        <div id="submitGood" class="hidden">
                            <button id="txt-btn-good" class="w-full bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow hover:bg-blue-700 transition-colors text-sm btn-disabled" disabled onclick="showMessage('Purchase Complete!')">
                                Complete Purchase
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar for issues -->
                <div class="lg:col-span-3 space-y-6">
                    <div id="critiquePanel" class="hidden bg-gray-900 text-white p-6 rounded-2xl shadow-xl space-y-4 h-full">
                        <h3 id="txt-critique-title" class="font-black text-xs uppercase tracking-tighter text-blue-400">What is wrong?</h3>
                        <div id="critiqueContent" class="text-[11px] space-y-4 opacity-90 leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="txt-modal-title">
            <h2 id="txt-modal-title" class="text-lg font-bold text-gray-900 mb-2">Confirm Terms</h2>
            <p id="txt-modal-body" class="text-sm text-gray-600 mb-6">Are you sure you want to accept the terms and conditions?</p>
            <div class="flex gap-3">
                <button id="btnModalOk" onclick="closeModal(true)" class="flex-1 bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">Yes</button>
                <button id="btnModalNotOk" onclick="closeModal(false)" class="flex-1 bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">No</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-8 py-4 rounded-2xl shadow-2xl opacity-0 transition-all pointer-events-none z-50"></div>

    <script>
        let isConfirmed = false;
        const TARGET_NAME = "John Doe";

        const translations = {
            en: {
                title: "Keyboard experience",
                nameLabel: "Name Surname",
                helpIcon: "Help icon",
                hiddenField: "Hidden field",
                birth: "Birth Date",
                format: "Format: dd/mm/yyyy",
                tooltip: "Here is a help text",
                termsPrefix: "I accept the",
                termsLink: "conditions",
                modalTitle: "Confirm Terms",
                modalBody: "Are you sure you want to accept the terms and conditions?",
                modalBtnOk: "Yes",
                modalBtnNotOk: "No",
                submit: "Complete Purchase",
                showIssues: "Show issues",
                showRemediations: "Show remediations",
                introGood: "Did you notice that the page hasn't visually changed ? Yet the form is now keyboard-friendly. Here is how:",
                critiqueTitleBad: "What is wrong?",
                critiqueTitleGood: "Remediations",
                toastSuccess: "Action Successful!",
                months: ["January","February","March","April","May","June","July","August","September","October","November","December"],
                statusInaccessible: "Inaccessible",
                statusAccessible: "Accessible",
                critiques: {
                    bad: [
                        { f: "Name Surname", c: "The form doesn't help you fill in your name. You have to type the whole thing manually every time." },
                        { f: "Help icon", c: "This information is hidden if you don't use a mouse. Keyboard users can't see this help text." },
                        { f: "The Void", c: "There is an invisible box between the fields. Your cursor will simply disappear, leaving you lost on the page." },
                        { f: "Birth Date", c: "Choosing a date takes too long. You have to click through every single day just to reach your year." },
                        { f: "I accept the conditions", c: "When navigating with a keyboard, it's impossible to tell that this checkbox is selected. There is no highlight." },
                        { f: "Confirmation Dialog", c: "The popup is disconnected from your keyboard. You can't see which button is selected, and the focus doesn't start in the right place." }
                    ],
                    good: [
                        { f: "Name Surname", c: "The browser remembers who you are and suggests your name as soon as you start typing." },
                        { f: "Help icon", c: "The help text is now easy to open for everyone, whether you use a mouse or a keyboard." },
                        { f: "Smooth Flow", c: "The invisible obstacle has been removed. Your cursor now moves logically from one field to the next." },
                        { f: "Birth Date", c: "You can now type your date directly and quickly. No more endless clicking through a calendar." },
                        { f: "I accept the conditions", c: "The checkbox is now clearly highlighted when you reach it, so you always know exactly where you are." },
                        { f: "Confirmation Dialog", c: "The selection starts exactly where you need it (on the 'Yes' button) and is clearly visible." }
                    ]
                }
            },
            fr: {
                title: "ExpÃ©rience clavier",
                nameLabel: "Nom PrÃ©nom",
                helpIcon: "IcÃ´ne d'aide",
                hiddenField: "Champ invisible",
                birth: "Date de Naissance",
                format: "Format : jj/mm/aaaa",
                tooltip: "Ceci est un texte d'aide",
                termsPrefix: "J'accepte les",
                termsLink: "conditions",
                modalTitle: "Confirmer les conditions",
                modalBody: "ÃŠtes-vous sÃ»r de vouloir accepter les termes et conditions ?",
                modalBtnOk: "Oui",
                modalBtnNotOk: "Non",
                submit: "Finaliser l'achat",
                showIssues: "Afficher les problÃ¨mes",
                showRemediations: "Afficher les corrections",
                introGood: "Avez-vous remarquÃ© que la page n'a pas changÃ© visuellement ? Pourtant, le formulaire est dÃ©sormais adaptÃ© au clavier. Voici comment :",
                critiqueTitleBad: "Qu'est-ce qui ne va pas ?",
                critiqueTitleGood: "Corrections",
                toastSuccess: "Action rÃ©ussie!",
                months: ["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"],
                statusInaccessible: "Inaccessible",
                statusAccessible: "Accessible",
                critiques: {
                    bad: [
                        { f: "Nom PrÃ©nom", c: "Le formulaire ne vous aide pas. Vous devez tout taper Ã  la main Ã  chaque fois." },
                        { f: "IcÃ´ne d'aide", c: "Cette info est cachÃ©e si vous n'utilisez pas de souris. Les utilisateurs clavier ne peuvent pas la voir." },
                        { f: "Le Vide", c: "Il y a une case invisible entre les champs. Votre curseur disparaÃ®t, et vous perdez le fil de la page." },
                        { f: "Date de Naissance", c: "Choisir une date est trop long. Il faut cliquer sur chaque jour pour arriver Ã  la bonne annÃ©e." },
                        { f: "J'accepte les conditions", c: "On ne peut pas savoir que cette case est sÃ©lectionnÃ©e au clavier. Elle n'est pas mise en avant." },
                        { f: "FenÃªtre de Confirmation", c: "La fenÃªtre est coupÃ©e du clavier. On ne voit pas quel bouton est choisi, et le curseur n'est pas au bon endroit." }
                    ],
                    good: [
                        { f: "Nom PrÃ©nom", c: "Le navigateur se souvient de vous et propose votre nom dÃ¨s les premiÃ¨res lettres." },
                        { f: "IcÃ´ne d'aide", c: "Le texte d'aide est dÃ©sormais facile Ã  ouvrir pour tout le monde, avec ou sans souris." },
                        { f: "Parcours Fluide", c: "L'obstacle invisible a Ã©tÃ© supprimÃ©. Le curseur avance logiquement d'un champ Ã  l'autre." },
                        { f: "Date de Naissance", c: "Vous pouvez taper votre date directement et rapidement sans passer par de multiples clics." },
                        { f: "J'accepte les conditions", c: "La case est clairement entourÃ©e quand vous arrivez dessus, vous savez toujours oÃ¹ vous Ãªtes." },
                        { f: "FenÃªtre de Confirmation", c: "La sÃ©lection commence exactement lÃ  oÃ¹ il faut (sur le bouton 'Oui') et est bien visible." }
                    ]
                }
            },
            nl: {
                title: "Toetsenbordervaring",
                nameLabel: "Naam Voornaam",
                helpIcon: "Help-icoon",
                hiddenField: "Verborgen veld",
                birth: "Geboortedatum",
                format: "Formaat: dd/mm/jjjj",
                tooltip: "Hier is een helptekst",
                termsPrefix: "Ik accepteer de",
                termsLink: "voorwaarden",
                modalTitle: "Bevestig voorwaarden",
                modalBody: "Weet u zeker dat u de voorwaarden wilt accepteren?",
                modalBtnOk: "Ja",
                modalBtnNotOk: "Nee",
                submit: "Aankoop Voltooien",
                showIssues: "Toon problemen",
                showRemediations: "Toon oplossingen",
                introGood: "Heb je gemerkt dat de pagina visueel niet is veranderd? Toch is het formulier nu toetsenbordvriendelijk. Hier is hoe:",
                critiqueTitleBad: "Wat is er mis?",
                critiqueTitleGood: "Oplossingen",
                toastSuccess: "Actie geslaagd!",
                months: ["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],
                statusInaccessible: "Inaccessible",
                statusAccessible: "Accessible",
                critiques: {
                    bad: [
                        { f: "Naam Voornaam", c: "Het formulier helpt je niet. Je moet alles elke keer opnieuw handmatig typen." },
                        { f: "Help-icoon", c: "Deze informatie is onzichtbaar zonder muis. Toetsenbordgebruikers kunnen de hulptekst niet zien." },
                        { f: "Het Gat", c: "Er zit een onzichtbaar vak tussen de velden. Je cursor verdwijnt en je raakt de weg kwijt op de pagina." },
                        { f: "Geboortedatum", c: "Een datum kiezen duurt te lang. Je moet door elke dag klikken om bij je jaar te komen." },
                        { f: "Ik accepteer de voorwaarden", c: "Het is onmogelijk om te zien dat dit vakje geselecteerd is. Er is geen markering." },
                        { f: "Bevestigingsvenster", c: "Het venster reageert niet goed op het toetsenbord. Je ziet niet welke knop gekozen is." }
                    ],
                    good: [
                        { f: "Naam Voornaam", c: "De browser onthoudt je naam en stelt deze direct voor zodra je begint te typen." },
                        { f: "Help-icoon", c: "De hulptekst is nu voor iedereen makkelijk te openen, ook zonder muis." },
                        { f: "Logische Route", c: "Het onzichtbare obstakel is weg. Je cursor beweegt nu logisch van het ene naar het volgende veld." },
                        { f: "Geboortedatum", c: "Je kunt de datum nu direct en snel typen. Geen eindeloos geklik meer in een kalender." },
                        { f: "Ik accepteer de voorwaarden", c: "Het vakje is nu duidelijk gemarkeerd, zodat je altijd weet waar je bent." },
                        { f: "Bevestigingsvenster", c: "De selectie begint direct op de juiste plek (de 'Ja' knop) en is goed zichtbaar." }
                    ]
                }
            },
            de: {
                title: "Tastaturerfahrung",
                nameLabel: "Vorname Nachname",
                helpIcon: "Hilfe-Icon",
                hiddenField: "Verstecktes Feld",
                birth: "Geburtsdatum",
                format: "Format: tt/mm/jjjj",
                tooltip: "Dies ist ein Hilfetext",
                termsPrefix: "Ich akzeptiere die",
                termsLink: "Bedingungen",
                modalTitle: "Bedingungen bestÃ¤tigen",
                modalBody: "Sind Sie sicher, dass Sie die Bedingungen akzeptieren mÃ¶chten?",
                modalBtnOk: "Ja",
                modalBtnNotOk: "Nein",
                submit: "Kauf abschlieÃŸen",
                showIssues: "Probleme anzeigen",
                showRemediations: "LÃ¶sungen anzeigen",
                introGood: "Haben Sie bemerkt, dass sich die Seite optisch nicht verÃ¤ndert hat? Dennoch ist das Formular nun tastaturfreundlich. Hier ist der Grund:",
                critiqueTitleBad: "Was ist falsch?",
                critiqueTitleGood: "LÃ¶sungen",
                toastSuccess: "Aktion erfolgreich!",
                months: ["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],
                statusInaccessible: "UnzugÃ¤nglich",
                statusAccessible: "ZugÃ¤nglich",
                critiques: {
                    bad: [
                        { f: "Vorname Nachname", c: "Das Formular hilft Ihnen nicht. Sie mÃ¼ssen alles jedes Mal manuell eingeben." },
                        { f: "Hilfe-Icon", c: "Diese Information ist ohne Maus versteckt. Tastaturbenutzer kÃ¶nnen den Hilfetext nicht sehen." },
                        { f: "Das Nichts", c: "Es gibt ein unsichtbares Feld zwischen den Eingaben. Ihr Cursor verschwindet einfach." },
                        { f: "Geburtsdatum", c: "Ein Datum zu wÃ¤hlen dauert zu lange. Man muss sich durch jeden Tag klicken." },
                        { f: "Ich akzeptiere die Bedingungen", c: "Es ist unmÃ¶glich zu erkennen, dass dieses Feld ausgewÃ¤hlt ist. Es gibt keine Markierung." },
                        { f: "BestÃ¤tigungsdialog", c: "Das Fenster ist von der Tastatur getrennt. Man sieht nicht, welcher Knopf gewÃ¤hlt ist." }
                    ],
                    good: [
                        { f: "Vorname Nachname", c: "Der Browser merkt sich Ihren Namen und schlÃ¤gt ihn vor, sobald Sie anfangen zu tippen." },
                        { f: "Hilfe-Icon", c: "Der Hilfetext ist nun fÃ¼r alle einfach zu Ã¶ffnen, egal ob mit Maus oder Tastatur." },
                        { f: "Direkter Weg", c: "Das unsichtbare Hindernis wurde entfernt. Ihr Cursor bewegt sich nun logisch von Feld zu Feld." },
                        { f: "Geburtsdatum", c: "Sie kÃ¶nnen Ihr Datum jetzt direkt und schnell eintippen, ohne langes Klicken." },
                        { f: "Ich akzeptiere die Bedingungen", c: "Das Feld ist nun deutlich markiert, sodass Sie immer wissen, wo Sie sich befinden." },
                        { f: "BestÃ¤tigungsdialog", c: "Die Auswahl startet genau dort, wo Sie sie brauchen (auf dem 'Ja'-Knopf) und ist gut sichtbar." }
                    ]
                }
            }
        };

        let currentLang = 'en';

        function forceAutocomplete(input) {
            if (!document.getElementById('modeToggle').checked) return;
            const suggestion = document.getElementById('email-suggestion');
            const val = input.value.toLowerCase();
            suggestion.value = val.length > 0 ? TARGET_NAME : "";
        }

        function handleDateInput(e) {
            let val = e.target.value.replace(/\D/g, ''); 
            if (val.length > 8) val = val.substring(0, 8);
            
            let finalVal = '';
            if (val.length > 0) {
                finalVal += val.substring(0, 2);
                if (val.length > 2) {
                    finalVal += '/' + val.substring(2, 4);
                    if (val.length > 4) {
                        finalVal += '/' + val.substring(4, 8);
                    }
                }
            }
            e.target.value = finalVal;
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-label-email').innerText = t.nameLabel;
            document.getElementById('txt-label-birth').innerText = t.birth;
            document.getElementById('txt-format-hint').innerText = t.format;
            document.getElementById('txt-tooltip').innerText = t.tooltip;
            document.getElementById('txt-terms-prefix').innerText = t.termsPrefix;
            document.getElementById('txt-terms-link').innerText = t.termsLink;
            document.getElementById('txt-modal-title').innerText = t.modalTitle;
            document.getElementById('txt-modal-body').innerText = t.modalBody;
            document.getElementById('btnModalOk').innerText = t.modalBtnOk;
            document.getElementById('btnModalNotOk').innerText = t.modalBtnNotOk;
            document.getElementById('txt-btn-bad').innerText = t.submit;
            document.getElementById('txt-btn-good').innerText = t.submit;
            document.getElementById('statusLabel').innerText = t.statusInaccessible;
            document.getElementById('accessibleLabel').innerText = t.statusAccessible;
            
            const mSelect = document.getElementById('monthSelect');
            mSelect.innerHTML = '';
            t.months.forEach((m, i) => {
                const opt = document.createElement('option');
                opt.value = (i+1).toString().padStart(2, '0');
                opt.textContent = m;
                if(i === 1) opt.selected = true;
                mSelect.appendChild(opt);
            });
            updateModeLabels();
            document.querySelectorAll('.lang-btn').forEach(btn => btn.className = "lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700");
            document.getElementById('btn-' + lang).className = "lang-btn px-2 py-1 rounded bg-blue-600 text-white";
        }

        function updateModeLabels() {
            const isAccessible = document.getElementById('modeToggle').checked;
            const t = translations[currentLang];
            const panel = document.getElementById('critiqueContent');
            const data = isAccessible ? t.critiques.good : t.critiques.bad;
            
            document.getElementById('txt-toggle-critique').innerText = isAccessible ? t.showRemediations : t.showIssues;
            document.getElementById('txt-critique-title').innerText = isAccessible ? t.critiqueTitleGood : t.critiqueTitleBad;

            let html = '';
            if (isAccessible) {
                html += `<p class="mb-6 font-bold text-blue-200 italic border-b border-gray-700 pb-4">${t.introGood}</p>`;
            }
            
            html += data.map(item => `
                <div class="mb-4">
                    <span class="text-blue-400 font-bold block mb-1 uppercase text-[10px] tracking-tight">${item.f}</span>
                    <p class="text-white">${item.c}</p>
                </div>
            `).join('');
            
            panel.innerHTML = html;
        }

        function toggleCritiquePanel() {
            document.getElementById('critiquePanel').classList.toggle('hidden', !document.getElementById('critiqueToggle').checked);
        }

        function toggleTooltip() {
            if (document.getElementById('modeToggle').checked) {
                const tt = document.getElementById('txt-tooltip');
                tt.classList.toggle('tooltip-visible');
                tt.classList.remove('hidden-forced');
            }
        }

        function hideTooltip() {
            const tt = document.getElementById('txt-tooltip');
            tt.classList.remove('tooltip-visible');
        }

        function handleTermsToggle() {
            const checkbox = document.getElementById('checkTerms');
            if (checkbox.checked) {
                const modal = document.getElementById('modalOverlay');
                const isAccessible = document.getElementById('modeToggle').checked;
                modal.style.display = 'flex';
                if (isAccessible) {
                    document.getElementById('btnModalOk').focus();
                }
            } else {
                isConfirmed = false;
                updateSubmitState();
            }
        }

        function closeModal(confirmed) {
            const modal = document.getElementById('modalOverlay');
            const isAccessible = document.getElementById('modeToggle').checked;
            modal.style.display = 'none';
            if (confirmed) {
                isConfirmed = true;
            } else {
                isConfirmed = false;
                document.getElementById('checkTerms').checked = false;
            }
            updateSubmitState();
            if (isAccessible) {
                document.getElementById('checkTerms').focus();
            }
        }

        function updateSubmitState() {
            const badBtn = document.getElementById('txt-btn-bad');
            const goodBtn = document.getElementById('txt-btn-good');
            if (isConfirmed) {
                badBtn.classList.remove('btn-disabled');
                goodBtn.classList.remove('btn-disabled');
                goodBtn.removeAttribute('disabled');
            } else {
                badBtn.classList.add('btn-disabled');
                goodBtn.classList.add('btn-disabled');
                goodBtn.setAttribute('disabled', 'true');
            }
        }

        function toggleMode() {
            const modeToggle = document.getElementById('modeToggle');
            const isAccessible = modeToggle.checked;
            const bodyTag = document.getElementById('bodyTag');
            const calContainer = document.getElementById('calendarContainer');
            
            modeToggle.setAttribute('aria-checked', isAccessible);
            calContainer.style.display = 'none';
            document.getElementById('inputEmail').value = '';
            document.getElementById('inputBirth').value = '';
            document.getElementById('checkTerms').checked = false;
            isConfirmed = false;
            updateSubmitState();

            renderCalendar(isAccessible);
            const inputBirth = document.getElementById('inputBirth');
            const inputEmail = document.getElementById('inputEmail');
            const theVoid = document.getElementById('theVoid');
            
            document.getElementById('txt-tooltip').classList.remove('tooltip-visible', 'hidden-forced');

            if (isAccessible) {
                bodyTag.className = "bg-gray-100 min-h-screen p-4 md:p-8 font-sans transition-colors duration-500 accessible-mode";
                inputBirth.removeAttribute('readonly');
                inputBirth.oninput = handleDateInput;
                document.getElementById('calendarToggleBtn').classList.remove('hidden');
                document.getElementById('calendarIconBad').classList.add('hidden');
                inputEmail.setAttribute('autocomplete', 'name');
                inputEmail.setAttribute('list', 'email-list');
                document.getElementById('emailIconBad').classList.add('hidden');
                document.getElementById('emailIconGood').classList.remove('hidden');
                document.getElementById('submitBad').classList.add('hidden');
                document.getElementById('submitGood').classList.remove('hidden');
                theVoid.style.display = 'none';
            } else {
                bodyTag.className = "bg-gray-100 min-h-screen p-4 md:p-8 font-sans transition-colors duration-500 inaccessible-mode";
                inputBirth.setAttribute('readonly', true);
                inputBirth.oninput = null;
                document.getElementById('calendarToggleBtn').classList.add('hidden');
                document.getElementById('calendarIconBad').classList.remove('hidden');
                inputEmail.setAttribute('autocomplete', 'off');
                inputEmail.removeAttribute('list');
                document.getElementById('emailIconBad').classList.remove('hidden');
                document.getElementById('emailIconGood').classList.add('hidden');
                document.getElementById('submitBad').classList.remove('hidden');
                document.getElementById('submitGood').classList.add('hidden');
                theVoid.style.display = 'block';
            }
            updateModeLabels();
        }

        function populateYears() {
            const yearSelect = document.getElementById('yearSelect');
            yearSelect.innerHTML = '';
            for (let yr = 2026; yr >= 1970; yr--) {
                const opt = document.createElement('option');
                opt.value = yr; opt.textContent = yr;
                yearSelect.appendChild(opt);
            }
        }

        function renderCalendar(isAccessible) {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            const today = 11;

            for (let i = 1; i <= 28; i++) {
                const dayStr = i.toString().padStart(2, '0');
                const isToday = i === today;
                
                const d = document.createElement('div');
                d.className = "calendar-day";
                d.innerText = i;
                
                if (isToday) {
                    d.classList.add('bg-blue-600', 'text-white');
                }

                if (isAccessible) {
                    d.setAttribute('tabindex', '0');
                    d.onclick = () => selectDate(dayStr);
                    d.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') selectDate(dayStr); };
                } else {
                    const b = document.createElement('button');
                    b.type = "button";
                    b.className = "calendar-day w-full h-full flex items-center justify-center rounded";
                    b.innerText = i;
                    if (isToday) b.classList.add('bg-blue-600', 'text-white');
                    b.onclick = () => selectDate(dayStr);
                    d.innerHTML = '';
                    d.appendChild(b);
                }
                grid.appendChild(d);
            }
        }

        function selectDate(day) {
            const input = document.getElementById('inputBirth');
            const month = document.getElementById('monthSelect').value;
            const year = document.getElementById('yearSelect').value;
            input.value = `${day}/${month}/${year}`;
            document.getElementById('calendarContainer').style.display = 'none';
        }

        function handleBirthFocus(isFocused) {
            if (isFocused && !document.getElementById('modeToggle').checked) {
                openCalendar();
            }
        }

        function toggleCalendarManual() {
            const c = document.getElementById('calendarContainer');
            if (c.style.display === 'block') {
                c.style.display = 'none';
            } else {
                openCalendar();
            }
        }

        function openCalendar() {
            const c = document.getElementById('calendarContainer');
            c.style.display = 'block';
            document.getElementById('monthSelect').focus();
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.getElementById('calendarContainer').style.display = 'none';
                if(document.getElementById('modalOverlay').style.display === 'flex') closeModal(false);
                if (document.getElementById('modeToggle').checked) {
                    document.querySelectorAll('.tooltip-box').forEach(t => t.classList.add('hidden-forced'));
                }
            }
        });

        document.addEventListener('focusin', (e) => {
            if (document.getElementById('modeToggle').checked) {
                const birthArea = document.getElementById('birthFieldWrapper');
                const calendarArea = document.getElementById('calendarContainer');
                if (birthArea && !birthArea.contains(e.target) && calendarArea && !calendarArea.contains(e.target)) {
                    document.getElementById('calendarContainer').style.display = 'none';
                }
            }
        });

        function showMessage(msg) {
            if (!isConfirmed) return;
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 3000);
        }

        populateYears();
        setLanguage('en');
        toggleMode();
    </script>
</body>
</html>
