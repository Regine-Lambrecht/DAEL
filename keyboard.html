<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard experience - Digital Accessibility Empathy Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .transition-all { transition: all 0.3s ease; }

        /* Hide default dropdown icons */
        input::-webkit-calendar-picker-indicator {
            display: none !important;
            -webkit-appearance: none;
            opacity: 0;
        }

        /* Deliberately breaking focus visualization for "The Bad Way" */
        .inaccessible-mode *:focus {
            outline: none !important;
            box-shadow: none !important;
        }

        /* Persistent keyboard accessibility for the actual lab controls */
        .lang-btn:focus-visible, 
        #critiqueToggle:focus-visible {
            outline: 2px solid #2563eb !important;
            outline-offset: 2px !important;
            border-radius: 4px;
        }

        .switch input:focus-visible + .slider {
            outline: 2px solid #2563eb;
            outline-offset: 4px;
            box-shadow: 0 0 0 2px white;
        }

        /* Focus styles for select elements in calendar */
        #monthSelect:focus, #yearSelect:focus {
            outline: 2px solid #2563eb !important;
            outline-offset: 1px;
        }

        .inaccessible-mode #checkTerms:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        
        .accessible-mode #checkTerms:focus-visible {
            outline: 2px solid #2563eb !important;
            outline-offset: 2px;
        }

        .inaccessible-mode .modal-content button:focus {
            outline: 1px solid #93c5fd !important; 
            outline-offset: 0px !important;
        }

        /* WCAG 2.2 Focus Appearance for Accessible version */
        .accessible-mode *:focus-visible {
            outline: 3px solid #2563eb !important;
            outline-offset: 2px !important;
            box-shadow: inset 0 0 0 2px white !important;
            border-radius: 4px;
        }

        .accessible-mode .modal-content button:focus-visible {
            box-shadow: inset 0 0 0 1px white !important; 
            outline: 3px solid #2563eb !important; 
            outline-offset: 0px !important;
        }

        /* Tooltip Box Styles */
        .tooltip-box {
            display: none;
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            width: 180px;
            z-index: 50;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .tooltip-box::after {
            content: "";
            position: absolute;
            top: 50%;
            right: 100%;
            margin-top: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent #1f2937 transparent transparent;
        }

        .info-icon-bad:hover ~ .tooltip-box, 
        .info-icon-good:hover ~ .tooltip-box { 
            display: block; 
        }
        
        .tooltip-visible { display: block !important; }
        .hidden-forced { display: none !important; }

        /* Calendar Styling */
        .calendar-popup {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 0.5rem;
            background: white;
            border: 1px solid #6b7280;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            z-index: 40;
            padding: 10px;
            border-radius: 10px;
            width: 210px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            background: #f3f4f6;
            padding: 6px;
            border-radius: 6px;
        }
        
        .calendar-day {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inaccessible-mode .calendar-day:focus {
            background-color: #2563eb !important;
            color: white !important;
            outline: none !important;
        }

        .accessible-mode .calendar-day:focus-visible {
            outline: none !important;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #2563eb !important;
            border-radius: 9999px !important;
            z-index: 10;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ef4444; transition: .4s; border-radius: 28px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #15803d; }
        input:checked + .slider:before { transform: translateX(22px); }

        .demo-container { max-width: 1200px; margin: 0 auto; }
        
        .btn-disabled {
            opacity: 0.4;
            cursor: not-allowed !important;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 font-sans transition-colors duration-500 inaccessible-mode" id="bodyTag">

    <div class="demo-container bg-white shadow-2xl rounded-3xl overflow-hidden">
        
        <header class="bg-white border-b border-gray-100">
            <!-- Empathy Lab Header -->
            <div class="p-6 flex flex-col md:flex-row justify-between items-center gap-6 border-b border-gray-50">
                <div class="flex flex-grow items-center">
                    <div id="txt-lab-title" class="text-xl md:text-2xl font-black tracking-tight leading-tight uppercase" style="color: #008B63;">Digital Accessibility Empathy Lab</div>
                </div>
                <div class="flex-shrink-0">
                    <img src="https://regine-lambrecht.github.io/color-contrast-checker-size-weight/images/banner.png" alt="Eleven Ways Logo" class="h-12 w-auto object-contain">
                </div>
            </div>

            <!-- Toolbar in a navigation landmark -->
            <nav class="p-4 flex flex-col gap-4" aria-label="Interface controls">
                <div class="flex flex-wrap items-center justify-between gap-4 bg-gray-50 p-3 rounded-2xl border border-gray-200 w-full">
                    <!-- Left Side: Toggle and Checkbox -->
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 pr-4 border-r border-gray-200">
                            <span id="statusLabel" class="text-xs font-black uppercase tracking-widest text-red-600">Inaccessible</span>
                            <label class="switch">
                                <input 
                                    type="checkbox" 
                                    id="modeToggle" 
                                    onchange="toggleMode()" 
                                    role="switch" 
                                    aria-label="Toggle accessibility version"
                                    aria-checked="false"
                                >
                                <span class="slider"></span>
                            </label>
                            <span id="accessibleLabel" class="text-xs font-black uppercase tracking-widest text-green-700">Accessible</span>
                        </div>

                        <div class="flex items-center gap-2">
                            <label for="critiqueToggle" id="txt-toggle-critique" class="text-[10px] font-bold text-gray-500 uppercase tracking-widest cursor-pointer">Show issues</label>
                            <input type="checkbox" id="critiqueToggle" onchange="toggleCritiquePanel()" class="w-4 h-4 cursor-pointer">
                        </div>
                    </div>

                    <!-- Right Side: Language Switcher -->
                    <div class="flex gap-2 text-[10px] font-bold">
                        <button onclick="setLanguage('en')" class="lang-btn px-2 py-1 rounded bg-blue-600 text-white" id="btn-en">EN</button>
                        <button onclick="setLanguage('fr')" class="lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700" id="btn-fr">FR</button>
                        <button onclick="setLanguage('nl')" class="lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700" id="btn-nl">NL</button>
                        <button onclick="setLanguage('de')" class="lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700" id="btn-de">DE</button>
                    </div>
                </div>

                <!-- Page title promoted to H1 -->
                <div class="w-full pl-2">
                    <h1 id="txt-title" class="text-xl font-black text-gray-900 tracking-tight text-left">Keyboard experience</h1>
                </div>
            </nav>
        </header>

        <main id="mainContent" class="p-6 md:p-10">
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-16">
                
                <div class="lg:col-span-1 space-y-6">
                    <div class="space-y-6">
                        
                        <!-- Name Field -->
                        <div class="flex flex-col w-48">
                            <div class="flex items-center gap-2 mb-1">
                                <label for="inputEmail" id="txt-label-email" class="text-xs font-semibold text-gray-600 uppercase tracking-wider">Name Surname</label>
                                <div class="relative flex items-center">
                                    <span id="emailIconBad" class="info-icon-bad w-6 h-6 flex items-center justify-center cursor-help" tabindex="0">
                                        <span class="w-4 h-4 rounded-full bg-blue-700 text-[9px] flex items-center justify-center font-bold text-white">i</span>
                                    </span>
                                    
                                    <button type="button" id="emailIconGood" onclick="toggleTooltip()" onblur="hideTooltip()" class="info-icon-good hidden w-6 h-6 flex items-center justify-center cursor-help hover:opacity-80" aria-label="Name information">
                                        <span class="w-4 h-4 rounded-full bg-blue-700 text-[9px] flex items-center justify-center font-bold text-white">i</span>
                                    </button>
                                    
                                    <div id="txt-tooltip" class="tooltip-box">Help text</div>
                                </div>
                            </div>
                            <input 
                                type="text" 
                                id="inputEmail" 
                                class="border border-gray-500 p-2 rounded-lg bg-gray-50 text-sm w-full" 
                                placeholder=""
                                autocomplete="off"
                                oninput="forceAutocomplete(this)"
                            >
                            <datalist id="email-list">
                                <option id="email-suggestion" value="John Doe">
                            </datalist>
                        </div>

                        <!-- Hidden field "The Void" -->
                        <div class="relative">
                            <input type="text" id="theVoid" class="absolute opacity-0 pointer-events-none" style="width:1px; height:1px;">
                        </div>

                        <!-- Passport Field -->
                        <div class="flex flex-col relative w-48">
                            <label for="inputPassport" id="txt-label-passport" class="text-xs font-semibold text-gray-600 uppercase tracking-wider">Passport issue date</label>
                            <span class="text-[9px] text-gray-600 mb-1" id="txt-format-hint">Format: dd/mm/yyyy</span>
                            <div class="relative flex items-center" id="passportFieldWrapper">
                                <input 
                                    type="text" 
                                    id="inputPassport" 
                                    class="w-full border border-gray-500 p-2 pr-10 rounded-lg bg-gray-50 text-sm" 
                                    value=""
                                    onfocus="handlePassportFocus(true)"
                                    readonly
                                >
                                <div class="absolute right-0 top-0 bottom-0 flex items-center pr-2">
                                    <span id="calendarIconBad" class="w-6 h-6 flex items-center justify-center text-sm cursor-default">ðŸ“…</span>
                                    <button 
                                        type="button" 
                                        id="calendarToggleBtn" 
                                        class="hidden w-6 h-6 flex items-center justify-center hover:opacity-70 transition-opacity text-sm focus:outline-none"
                                        aria-label="Open calendar"
                                        onclick="toggleCalendarManual()"
                                    >
                                        ðŸ“…
                                    </button>
                                </div>
                            </div>
                            
                            <div id="calendarContainer" class="calendar-popup">
                                <div class="flex gap-2 mb-2">
                                    <select id="monthSelect" class="text-[10px] border border-gray-500 p-1 rounded bg-white w-1/2"></select>
                                    <select id="yearSelect" class="text-[10px] border border-gray-500 p-1 rounded bg-white w-1/2"></select>
                                </div>
                                <div class="calendar-grid" id="calendarGrid"></div>
                            </div>
                        </div>

                        <!-- Terms Checkbox -->
                        <div class="flex items-center gap-3 py-2 max-w-sm">
                            <input type="checkbox" id="checkTerms" class="w-4 h-4 cursor-pointer" onchange="handleTermsToggle()">
                            <label for="checkTerms" class="text-sm font-semibold text-gray-700">
                                <span id="txt-terms-prefix">I accept the</span> 
                                <a href="https://elevenways.be" target="_blank" class="text-blue-700 underline hover:text-blue-900" id="txt-terms-link">conditions</a>
                            </label>
                        </div>
                    </div>

                    <div class="pt-4 w-48">
                        <div id="submitBad">
                            <div id="txt-btn-bad" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg text-center cursor-pointer shadow transition-colors text-sm btn-disabled" onclick="showMessage('Purchase Complete!')">
                                Complete Purchase
                            </div>
                        </div>
                        <div id="submitGood" class="hidden">
                            <button id="txt-btn-good" class="w-full bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow hover:bg-blue-700 transition-colors text-sm btn-disabled" disabled onclick="showMessage('Purchase Complete!')">
                                Complete Purchase
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar for issues -->
                <div class="lg:col-span-3 space-y-6">
                    <div id="critiquePanel" class="hidden bg-gray-900 text-white p-8 rounded-2xl shadow-xl space-y-6 h-full">
                        <h3 id="txt-critique-title" class="font-black text-xs uppercase tracking-tighter text-blue-400">What is wrong?</h3>
                        <div id="critiqueContent" class="text-sm space-y-6 opacity-95 leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="txt-modal-title">
            <h2 id="txt-modal-title" class="text-lg font-bold text-gray-900 mb-2">Confirm</h2>
            <p id="txt-modal-body" class="text-sm text-gray-600 mb-6">Are you sure you want to accept the terms and conditions?</p>
            <div class="flex gap-3">
                <button id="btnModalOk" onclick="closeModal(true)" class="flex-1 bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">Yes</button>
                <button id="btnModalNotOk" onclick="closeModal(false)" class="flex-1 bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">No</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-8 py-4 rounded-2xl shadow-2xl opacity-0 transition-all pointer-events-none z-50"></div>

    <script>
        let isConfirmed = false;
        const TARGET_NAME = "John Doe";

        const translations = {
            en: {
                labTitle: "Digital Accessibility Empathy Lab",
                title: "Keyboard experience",
                nameLabel: "Name Surname",
                helpIcon: "Help icon",
                passport: "Passport issue date",
                format: "Format: dd/mm/yyyy",
                tooltip: "Here is some help.",
                termsPrefix: "I accept the",
                termsLink: "conditions",
                modalTitle: "Confirm",
                modalBody: "Are you sure you want to accept?",
                modalBtnOk: "Yes",
                modalBtnNotOk: "No",
                submit: "Complete Purchase",
                showIssues: "Show issues",
                showRemediations: "Show remediations",
                introGood: "Did you notice that the page hasn't visually changed ? Yet the form is now keyboard-friendly. Here is how:",
                critiqueTitleBad: "What is wrong?",
                critiqueTitleGood: "How it was fixed",
                toastSuccess: "Action Successful!",
                months: ["January","February","March","April","May","June","July","August","September","October","November","December"],
                statusInaccessible: "Inaccessible",
                statusAccessible: "Accessible",
                critiques: {
                    bad: [
                        { f: "Name Field", c: "The form doesn't suggest your name. You have to type the whole thing every single time." },
                        { f: "Help info", c: "This information is hidden unless you use a mouse. Keyboard users cannot see this help text." },
                        { f: "Empty space", c: "There is an invisible spot between fields where your cursor gets lost, making you lose track of where you are." },
                        { f: "Passport field", c: "Picking a date takes too long. You have to click many times just to find the right year." },
                        { f: "Checkboxes", c: "It's hard to tell when the checkbox is selected with the keyboard. There is no clear highlight around it." },
                        { f: "Popups", c: "The window opens but doesn't highlight the buttons. You can't see which one is ready to be clicked." }
                    ],
                    good: [
                        { f: "Smart suggestions", c: "The browser remembers your name and suggests it automatically as soon as you start typing." },
                        { f: "Easy help", c: "The help text is now simple to open for everyone, whether using a mouse or a keyboard." },
                        { f: "Smooth path", c: "The invisible obstacles are gone. Your cursor now moves logically from one field to the next." },
                        { f: "Quick date", c: "You can now type your date directly and quickly. It is much faster than clicking through a calendar." },
                        { f: "Clear focus", c: "The checkbox is clearly highlighted when you reach it, so you always know exactly where you are." },
                        { f: "Ready to click", c: "The selection starts exactly on the 'Yes' button and is clearly visible." }
                    ]
                }
            },
            fr: {
                labTitle: "Labo d'Empathie AccessibilitÃ© NumÃ©rique",
                title: "ExpÃ©rience clavier",
                nameLabel: "Nom PrÃ©nom",
                helpIcon: "Bulle d'aide",
                passport: "Date d'Ã©mission du passeport",
                format: "Format : jj/mm/aaaa",
                tooltip: "Voici une aide.",
                termsPrefix: "J'accepte les",
                termsLink: "conditions",
                modalTitle: "Confirmer",
                modalBody: "Voulez-vous accepter ?",
                modalBtnOk: "Oui",
                modalBtnNotOk: "Non",
                submit: "Finaliser l'achat",
                showIssues: "Afficher les problÃ¨mes",
                showRemediations: "Afficher les corrections",
                introGood: "Avez-vous remarquÃ© que la page n'a pas changÃ© visuellement ? Pourtant, le formulaire est dÃ©sormais adaptÃ© au clavier. Voici comment :",
                critiqueTitleBad: "Le problÃ¨me ?",
                critiqueTitleGood: "La solution",
                toastSuccess: "RÃ©ussi !",
                months: ["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"],
                statusInaccessible: "Inaccessible",
                statusAccessible: "Accessible",
                critiques: {
                    bad: [
                        { f: "Champ Nom", c: "Votre nom n'est pas proposÃ© automatiquement. Vous devez tout taper Ã  la main Ã  chaque fois." },
                        { f: "Bulle d'aide", c: "L'info est cachÃ©e si vous n'utilisez pas de souris. Les utilisateurs clavier ne peuvent pas la voir." },
                        { f: "Le Vide", c: "Il y a une zone invisible entre les cases. Votre curseur s'y perd et vous ne savez plus oÃ¹ vous Ãªtes." },
                        { f: "Date du passeport", c: "Choisir une date est trop long. Il faut cliquer de nombreuses fois pour arriver Ã  l'annÃ©e." },
                        { f: "Cases Ã  cocher", c: "On ne voit pas quand la case est sÃ©lectionnÃ©e au clavier. Elle n'est pas mise en Ã©vidence." },
                        { f: "FenÃªtres", c: "La fenÃªtre s'ouvre mais on ne voit pas quel bouton est prÃªt Ã  Ãªtre cliquÃ©." }
                    ],
                    good: [
                        { f: "Suggestions", c: "Le navigateur propose votre nom automatiquement dÃ¨s les premiÃ¨res lettres." },
                        { f: "Aide accessible", c: "L'aide est facile Ã  ouvrir pour tout le monde, avec ou sans souris." },
                        { f: "Parcours direct", c: "L'obstacle invisible est supprimÃ©. Le curseur avance logiquement." },
                        { f: "Date rapide", c: "Vous pouvez taper votre date directement. C'est bien plus rapide." },
                        { f: "Indicateur clair", c: "La case est bien entourÃ©e quand vous arrivez dessus." },
                        { f: "PrÃªt Ã  cliquer", c: "La sÃ©lection se place directement sur le bouton 'Oui'." }
                    ]
                }
            },
            nl: {
                labTitle: "Toegankelijkheid Empathie Lab",
                title: "Toetsenbordervaring",
                nameLabel: "Naam Voornaam",
                helpIcon: "Help-icoon",
                passport: "Afgiftedatum paspoort",
                format: "Formaat: dd/mm/jjjj",
                tooltip: "Hier is een helptekst",
                termsPrefix: "Ik accepteer de",
                termsLink: "voorwaarden",
                modalTitle: "Bevestigen",
                modalBody: "Wilt u accepteren?",
                modalBtnOk: "Ja",
                modalBtnNotOk: "Nee",
                submit: "Voltooien",
                showIssues: "Toon problemen",
                showRemediations: "Toon oplossingen",
                introGood: "Heb je gemerkt dat de pagina visueel niet is veranderd? Toch is het formulier nu toetsenbordvriendelijk. Hier is hoe:",
                critiqueTitleBad: "Wat is er mis?",
                critiqueTitleGood: "Hoe het is opgelost",
                toastSuccess: "Gelukt!",
                months: ["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],
                statusInaccessible: "Niet toegankelijk",
                statusAccessible: "Toegankelijk",
                critiques: {
                    bad: [
                        { f: "Naamveld", c: "Je naam wordt niet voorgesteld. Je moet alles elke keer handmatig typen." },
                        { f: "Hulpinformatie", c: "Deze info is onzichtbaar zonder muis. Toetsenbordgebruikers zien dit niet." },
                        { f: "Lege gaten", c: "De cursor verdwijnt op onzichtbare plekken tussen de velden." },
                        { f: "Paspoort datum", c: "Een datum kiezen duurt te lang door het vele klikken." },
                        { f: "Vinkjes", c: "Je ziet niet wanneer een vinkje geselecteerd is met het toetsenbord." },
                        { f: "Vensters", c: "Je ziet niet welke knop actief is in het nieuwe venster." }
                    ],
                    good: [
                        { f: "Slimme suggesties", c: "De browser onthoudt je naam en stelt deze direct voor." },
                        { f: "Makkelijke hulp", c: "Hulptekst is nu voor iedereen makkelijk te openen." },
                        { f: "Vlotte route", c: "Onzichtbare hindernissen zijn weg. De cursor beweegt logisch." },
                        { f: "Snel datum", c: "Je kunt de datum nu direct typen. Dat is veel sneller." },
                        { f: "Duidelijke focus", c: "Het vakje is goed gemarkeerd als je er bent." },
                        { f: "Klaar om te klikken", c: "De keuze begint direct op de 'Ja' knop." }
                    ]
                }
            },
            de: {
                labTitle: "Barrierefreiheit Empathie-Labor",
                title: "Tastaturerfahrung",
                nameLabel: "Vorname Nachname",
                helpIcon: "Hilfe-Icon",
                passport: "Ausstellungsdatum des Reisepasses",
                format: "Format: tt/mm/jjjj",
                tooltip: "Dies ist ein Hilfetext",
                termsPrefix: "Ich akzeptiere die",
                termsLink: "Bedingungen",
                modalTitle: "BestÃ¤tigen",
                modalBody: "Sind Sie sicher?",
                modalBtnOk: "Ja",
                modalBtnNotOk: "Nein",
                submit: "Kauf abschlieÃŸen",
                showIssues: "Probleme anzeigen",
                showRemediations: "LÃ¶sungen anzeigen",
                introGood: "Haben Sie bemerkt, dass sich die Seite optisch nicht verÃ¤ndert hat? Dennoch ist das Formular nun tastaturfreundlich. Hier ist der Grund:",
                critiqueTitleBad: "Was ist falsch?",
                critiqueTitleGood: "Wie wir es gelÃ¶st haben",
                toastSuccess: "Erfolgreich!",
                months: ["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],
                statusInaccessible: "Nicht zugÃ¤nglich",
                statusAccessible: "ZugÃ¤nglich",
                critiques: {
                    bad: [
                        { f: "Namensfeld", c: "Das Formular schlÃ¤gt Ihren Namen nicht vor. Sie mÃ¼ssen alles selbst tippen." },
                        { f: "Hilfetext", c: "Diese Information ist ohne Maus versteckt. Tastaturnutzer kÃ¶nnen sie nicht sehen." },
                        { f: "Leerraum", c: "Der Cursor verschwindet an unsichtbaren Stellen zwischen den Feldern." },
                        { f: "Paspoort-Datum", c: "Ein Datum zu wÃ¤hlen dauert zu lange durch das viele Klicken." },
                        { f: "HÃ¤kchen", c: "Man sieht nicht, wenn ein Feld mit der Tastatur gewÃ¤hlt ist." },
                        { f: "Fenster", c: "Man sieht nicht, welcher Knopf im Fenster gerade aktiv ist." }
                    ],
                    good: [
                        { f: "VorschlÃ¤ge", c: "Der Browser schlÃ¤gt Ihren Namen automatisch vor." },
                        { f: "Einfache Hilfe", c: "Hilfetexte sind jetzt fÃ¼r alle leicht zu Ã¶ffnen." },
                        { f: "Direkter Weg", c: "Hindernisse sind weg. Der Cursor bewegt sich logisch." },
                        { f: "Schnelles Datum", c: "Sie kÃ¶nnen das Datum jetzt direkt eintippen. Das geht viel schneller." },
                        { f: "Klarer Fokus", c: "Das Feld ist deutlich markiert, wenn Sie es erreichen." },
                        { f: "Klickbereit", c: "Die Auswahl startet direkt auf dem 'Ja'-Knopf." }
                    ]
                }
            }
        };

        let currentLang = 'en';

        // Autocomplete suggestions
        function forceAutocomplete(input) {
            if (!document.getElementById('modeToggle').checked) return;
            const suggestion = document.getElementById('email-suggestion');
            const val = input.value.toLowerCase();
            suggestion.value = val.length > 0 ? TARGET_NAME : "";
        }

        function handleDateInput(e) {
            let val = e.target.value.replace(/\D/g, ''); 
            if (val.length > 8) val = val.substring(0, 8);
            let finalVal = '';
            if (val.length > 0) {
                finalVal += val.substring(0, 2);
                if (val.length > 2) {
                    finalVal += '/' + val.substring(2, 4);
                    if (val.length > 4) finalVal += '/' + val.substring(4, 8);
                }
            }
            e.target.value = finalVal;
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            // FIXED: Ensuring all references match the correct IDs
            const labTitleEl = document.getElementById('txt-lab-title');
            if (labTitleEl) labTitleEl.innerText = t.labTitle;
            
            const titleEl = document.getElementById('txt-title');
            if (titleEl) titleEl.innerText = t.title;
            
            const emailLabelEl = document.getElementById('txt-label-email');
            if (emailLabelEl) emailLabelEl.innerText = t.nameLabel;
            
            const passportLabelEl = document.getElementById('txt-label-passport');
            if (passportLabelEl) passportLabelEl.innerText = t.passport;
            
            const formatHintEl = document.getElementById('txt-format-hint');
            if (formatHintEl) formatHintEl.innerText = t.format;
            
            const tooltipEl = document.getElementById('txt-tooltip');
            if (tooltipEl) tooltipEl.innerText = t.tooltip;
            
            const termsPrefixEl = document.getElementById('txt-terms-prefix');
            if (termsPrefixEl) termsPrefixEl.innerText = t.termsPrefix;
            
            const termsLinkEl = document.getElementById('txt-terms-link');
            if (termsLinkEl) termsLinkEl.innerText = t.termsLink;
            
            const modalTitleEl = document.getElementById('txt-modal-title');
            if (modalTitleEl) modalTitleEl.innerText = t.modalTitle;
            
            const modalBodyEl = document.getElementById('txt-modal-body');
            if (modalBodyEl) modalBodyEl.innerText = t.modalBody;
            
            const modalOkEl = document.getElementById('btnModalOk');
            if (modalOkEl) modalOkEl.innerText = t.modalBtnOk;
            
            const modalNotOkEl = document.getElementById('btnModalNotOk');
            if (modalNotOkEl) modalNotOkEl.innerText = t.modalBtnNotOk;
            
            const btnBadEl = document.getElementById('txt-btn-bad');
            if (btnBadEl) btnBadEl.innerText = t.submit;
            
            const btnGoodEl = document.getElementById('txt-btn-good');
            if (btnGoodEl) btnGoodEl.innerText = t.submit;
            
            const statusLabelEl = document.getElementById('statusLabel');
            if (statusLabelEl) statusLabelEl.innerText = t.statusInaccessible;
            
            const accessibleLabelEl = document.getElementById('accessibleLabel');
            if (accessibleLabelEl) accessibleLabelEl.innerText = t.statusAccessible;
            
            const mSelect = document.getElementById('monthSelect');
            if (mSelect) {
                mSelect.innerHTML = '';
                t.months.forEach((m, i) => {
                    const opt = document.createElement('option');
                    opt.value = (i+1).toString().padStart(2, '0');
                    opt.textContent = m;
                    if(i === 1) opt.selected = true;
                    mSelect.appendChild(opt);
                });
            }
            updateModeLabels();
            document.querySelectorAll('.lang-btn').forEach(btn => btn.className = "lang-btn px-2 py-1 rounded bg-gray-200 text-gray-700");
            const activeLangBtn = document.getElementById('btn-' + lang);
            if (activeLangBtn) activeLangBtn.className = "lang-btn px-2 py-1 rounded bg-blue-600 text-white";
        }

        function updateModeLabels() {
            const modeToggle = document.getElementById('modeToggle');
            if (!modeToggle) return;
            const isAccessible = modeToggle.checked;
            const t = translations[currentLang];
            const panel = document.getElementById('critiqueContent');
            if (!panel) return;
            const data = isAccessible ? t.critiques.good : t.critiques.bad;
            
            const toggleCritiqueEl = document.getElementById('txt-toggle-critique');
            if (toggleCritiqueEl) toggleCritiqueEl.innerText = isAccessible ? t.showRemediations : t.showIssues;
            
            const critiqueTitleEl = document.getElementById('txt-critique-title');
            if (critiqueTitleEl) critiqueTitleEl.innerText = isAccessible ? t.critiqueTitleGood : t.critiqueTitleBad;

            let html = isAccessible ? `<p class="mb-6 font-bold text-blue-200 italic border-b border-gray-700 pb-4">${t.introGood}</p>` : '';
            html += data.map(item => `
                <div class="mb-6">
                    <span class="text-blue-400 font-bold block mb-1 uppercase text-[11px] tracking-tight">${item.f}</span>
                    <p class="text-white text-sm">${item.c}</p>
                </div>
            `).join('');
            panel.innerHTML = html;
        }

        function toggleCritiquePanel() {
            const panel = document.getElementById('critiquePanel');
            const toggle = document.getElementById('critiqueToggle');
            if (panel && toggle) panel.classList.toggle('hidden', !toggle.checked);
        }

        function toggleTooltip() {
            if (document.getElementById('modeToggle').checked) {
                const tt = document.getElementById('txt-tooltip');
                if (tt) tt.classList.toggle('tooltip-visible');
            }
        }
        
        function hideTooltip() {
            const tt = document.getElementById('txt-tooltip');
            if (tt) tt.classList.remove('tooltip-visible');
        }

        function handleTermsToggle() {
            const check = document.getElementById('checkTerms');
            if (check && check.checked) {
                const modal = document.getElementById('modalOverlay');
                if (modal) {
                    modal.style.display = 'flex';
                    if (document.getElementById('modeToggle').checked) {
                        const okBtn = document.getElementById('btnModalOk');
                        if (okBtn) okBtn.focus();
                    }
                }
            } else {
                isConfirmed = false;
                updateSubmitState();
            }
        }

        function closeModal(confirmed) {
            const modal = document.getElementById('modalOverlay');
            if (modal) modal.style.display = 'none';
            if (confirmed) {
                isConfirmed = true; 
            } else { 
                isConfirmed = false; 
                const check = document.getElementById('checkTerms');
                if (check) check.checked = false; 
            }
            updateSubmitState();
            if (document.getElementById('modeToggle').checked) {
                const check = document.getElementById('checkTerms');
                if (check) check.focus();
            }
        }

        function updateSubmitState() {
            const bad = document.getElementById('txt-btn-bad');
            const good = document.getElementById('txt-btn-good');
            if (isConfirmed) {
                if (bad) bad.classList.remove('btn-disabled');
                if (good) {
                    good.classList.remove('btn-disabled');
                    good.removeAttribute('disabled');
                }
            } else {
                if (bad) bad.classList.add('btn-disabled');
                if (good) {
                    good.classList.add('btn-disabled');
                    good.setAttribute('disabled', 'true');
                }
            }
        }

        function toggleMode() {
            const modeToggle = document.getElementById('modeToggle');
            if (!modeToggle) return;
            const isAccessible = modeToggle.checked;
            modeToggle.setAttribute('aria-checked', isAccessible);
            const cal = document.getElementById('calendarContainer');
            if (cal) cal.style.display = 'none';
            
            const emailInput = document.getElementById('inputEmail');
            const passportInput = document.getElementById('inputPassport');
            const check = document.getElementById('checkTerms');
            
            if (emailInput) emailInput.value = '';
            if (passportInput) passportInput.value = '';
            if (check) check.checked = false;
            
            isConfirmed = false;
            updateSubmitState();
            renderCalendar(isAccessible);
            
            const body = document.getElementById('bodyTag');
            const toggleBtn = document.getElementById('calendarToggleBtn');
            const iconBad = document.getElementById('calendarIconBad');
            const emailIconBad = document.getElementById('emailIconBad');
            const emailIconGood = document.getElementById('emailIconGood');
            const submitBad = document.getElementById('submitBad');
            const submitGood = document.getElementById('submitGood');
            const theVoid = document.getElementById('theVoid');

            if (isAccessible) {
                if (body) body.className = "bg-gray-100 min-h-screen p-4 md:p-8 font-sans transition-colors duration-500 accessible-mode";
                if (passportInput) {
                    passportInput.removeAttribute('readonly');
                    passportInput.oninput = handleDateInput;
                }
                if (toggleBtn) toggleBtn.classList.remove('hidden');
                if (iconBad) iconBad.classList.add('hidden');
                if (emailIconBad) emailIconBad.classList.add('hidden');
                if (emailIconGood) emailIconGood.classList.remove('hidden');
                if (submitBad) submitBad.classList.add('hidden');
                if (submitGood) submitGood.classList.remove('hidden');
                if (emailInput) {
                    emailInput.setAttribute('autocomplete', 'name');
                    emailInput.setAttribute('list', 'email-list');
                }
                if (theVoid) theVoid.style.display = 'none';
            } else {
                if (body) body.className = "bg-gray-100 min-h-screen p-4 md:p-8 font-sans transition-colors duration-500 inaccessible-mode";
                if (passportInput) {
                    passportInput.setAttribute('readonly', true);
                    passportInput.oninput = null;
                }
                if (toggleBtn) toggleBtn.classList.add('hidden');
                if (iconBad) iconBad.classList.remove('hidden');
                if (emailIconBad) emailIconBad.classList.remove('hidden');
                if (emailIconGood) emailIconGood.classList.add('hidden');
                if (submitBad) submitBad.classList.remove('hidden');
                if (submitGood) submitGood.classList.add('hidden');
                if (emailInput) {
                    emailInput.setAttribute('autocomplete', 'off');
                    emailInput.removeAttribute('list');
                }
                if (theVoid) theVoid.style.display = 'block';
            }
            updateModeLabels();
        }

        function populateYears() {
            const ys = document.getElementById('yearSelect');
            if (ys) {
                ys.innerHTML = '';
                for (let yr = 2026; yr >= 1970; yr--) {
                    const opt = document.createElement('option');
                    opt.value = yr; opt.textContent = yr;
                    ys.appendChild(opt);
                }
            }
        }

        function renderCalendar(isAccessible) {
            const grid = document.getElementById('calendarGrid');
            if (!grid) return;
            grid.innerHTML = '';
            const today = 11;
            for (let i = 1; i <= 28; i++) {
                const dayStr = i.toString().padStart(2, '0');
                const isToday = i === today;
                const d = document.createElement('div');
                d.className = "calendar-day";
                d.innerText = i;
                if (isToday) d.classList.add('bg-blue-600', 'text-white');
                if (isAccessible) {
                    d.setAttribute('tabindex', '0');
                    d.onclick = () => selectDate(dayStr);
                    d.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') selectDate(dayStr); };
                } else {
                    const b = document.createElement('button');
                    b.type = "button";
                    b.className = "calendar-day w-full h-full flex items-center justify-center rounded";
                    b.innerText = i;
                    if (isToday) b.classList.add('bg-blue-600', 'text-white');
                    b.onclick = () => selectDate(dayStr);
                    d.innerHTML = ''; d.appendChild(b);
                }
                grid.appendChild(d);
            }
        }

        function selectDate(day) {
            const input = document.getElementById('inputPassport');
            const mSelect = document.getElementById('monthSelect');
            const ySelect = document.getElementById('yearSelect');
            if (input && mSelect && ySelect) {
                input.value = `${day}/${mSelect.value}/${ySelect.value}`;
            }
            const cal = document.getElementById('calendarContainer');
            if (cal) cal.style.display = 'none';
        }

        function handlePassportFocus(isFocused) {
            const toggle = document.getElementById('modeToggle');
            if (isFocused && toggle && !toggle.checked) openCalendar();
        }

        function toggleCalendarManual() {
            const cal = document.getElementById('calendarContainer');
            if (cal) {
                if (cal.style.display === 'block') cal.style.display = 'none';
                else openCalendar();
            }
        }

        function openCalendar() {
            const cal = document.getElementById('calendarContainer');
            if (cal) {
                cal.style.display = 'block';
                const mSelect = document.getElementById('monthSelect');
                if (mSelect) mSelect.focus();
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const cal = document.getElementById('calendarContainer');
                if (cal) cal.style.display = 'none';
                const modal = document.getElementById('modalOverlay');
                if(modal && modal.style.display === 'flex') closeModal(false);
                hideTooltip();
            }
        });

        document.addEventListener('focusin', (e) => {
            const toggle = document.getElementById('modeToggle');
            if (toggle && toggle.checked) {
                const wrapper = document.getElementById('passportFieldWrapper');
                const container = document.getElementById('calendarContainer');
                if (wrapper && !wrapper.contains(e.target) && container && !container.contains(e.target)) {
                    if (container) container.style.display = 'none';
                }
            }
        });

        populateYears();
        setLanguage('en');
        toggleMode();
    </script>
</body>
</html>
